# íŠ¹í™” í”„ë¡œì íŠ¸ - ìˆ˜ìƒí•œ ë™ë¬¼ ì‚¬ì „(AI)

 ## ğŸ±â€ğŸ’» 5252

| ì´ë¦„          | ë‹´ë‹¹           |
| ------------- | -------------- |
| ê¹€ì˜ìˆ˜ (íŒ€ì¥) | AI + í’€ ìŠ¤íƒ   |
| êµ¬ë™ì—½        | ì„œë²„ + ë°± ì—”ë“œ |
| ì´ê²½ë¯¼        | ë°± ì—”ë“œ        |
| ì´ì€ì¬        | AI ê°œë°œ        |
| ì„í˜œë¯¼        | í”„ë¡ íŠ¸ ì—”ë“œ    |

## ëª©ì°¨

1. ìˆ˜ìƒí•œ ë™ë¬¼ ì‚¬ì „ í”„ë¡œì íŠ¸ë€?
2. ìˆ˜ìƒí•œ ë™ë¬¼ ì‚¬ì „ í”„ë¡œì íŠ¸ ì •ë³´
   1. ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ
   2. Git Convention
   3. ì™€ì´ì–´ í”„ë ˆì„
   4. ì‚¬ìš© íŒ¨í‚¤ì§€, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±
3. ì‚¬ìš©í•œ ì½”ë“œ ë¦¬ë·°
## 1. ìˆ˜ìƒí•œ ë™ë¬¼ ì‚¬ì „ í”„ë¡œì íŠ¸ë€?   ![badge](https://img.shields.io/badge/%ED%8A%B9%ED%99%94PJT-5252-brightgreen)

**ìˆ˜ìƒí•œ ë™ë¬¼ ì‚¬ì „** í”„ë¡œì íŠ¸ëŠ” ìŠ¤ìº” AIê¸°ìˆ ì„ ì´ìš©í•œ ë‚˜ë§Œì˜ ë™ë¬¼ ë„ê° & ë™ë¬¼ ë¶„ì„ì…ë‹ˆë‹¤. 

'ì¼ìƒìƒí™œì—ì„œ ë§Œë‚˜ëŠ” ë™ë¬¼ì˜ ì¢…ë¥˜ê°€ ê¶ê¸ˆí•˜ì‹  ë¶„', 'ìì‹ ê³¼ ë¹„ìŠ·í•œ ë™ë¬¼ì„ ê¶ê¸ˆí•´ í•˜ì‹œëŠ” ë¶„'ì„ ìœ„í•´ **AI ë™ë¬¼ ë¶„ì„ ë„ê°**ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

**ã€Œëˆ„êµ¬ë‚˜ ì‰½ê³  ê°„í¸í•˜ê²Œ ë™ë¬¼ì„ ì‹ë³„í•  ìˆ˜ ìˆê³ , ì¬ë°Œê²Œ ìì‹ ê³¼ ë‹®ì€ ë™ë¬¼ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ëª¨ë°”ì¼ ì›¹ã€**ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

í˜„ì¬ ì´ 100ì¢…ì˜ ë™ë¬¼ì´ ìˆê³  ë”ìš± ëŠ˜ë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.

### íŠ¹ì§•

- ì–¸ì œ ì–´ë””ì„œë‚˜ ë™ë¬¼, ì¸ë¬¼ ì‚¬ì§„ë§Œ ìˆìœ¼ë©´ 100ì¢…ì˜ ë™ë¬¼ ì¤‘ ê°™ê±°ë‚˜ ë¹„ìŠ·í•œ AIê°€ ìˆœì‹ê°„ì— ê²€ìƒ‰í•´ì¤ë‹ˆë‹¤.
- ë‚´ê°€ ë‹®ì€ ë™ë¬¼ ë¬´ì—‡ì¸ì§€ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì—¬ëŸ¬ë¶„ì˜ ì‚¬ì§„ê³¼ ì¶©ë¶„í•œ í•´ì„¤ë¡œ ë™ë¬¼ì˜ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¥¼ í†µí•´ í•˜ë‚˜ ë¿ì¸ ë‚˜ë§Œì˜ ë™ë¬¼ ë„ê°ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-20201007211725559](image-20201007211725559.png)



## 2. ìˆ˜ìƒí•œ ë™ë¬¼ ì‚¬ì „ í”„ë¡œì íŠ¸ ì •ë³´

> í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ë©° ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ê¸°ìˆ  ìŠ¤íƒ ë° íŒ€ ë£°ì— ê´€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

### 2-1. ê¸°ìˆ  ìŠ¤íƒ ![badge](https://img.shields.io/badge/%ED%8A%B9%ED%99%94PJT-5252-brightgreen)

-------------------------

![badge](https://img.shields.io/badge/browser-chrome-red)![badge](https://img.shields.io/badge/framework-Django%20Vue.js-yellow)![badge](https://img.shields.io/badge/DB-sqlite3-skyblue)![badge](https://img.shields.io/badge/node-12.18.2-brightgreen)![badge](https://img.shields.io/badge/npm-6.14.5-brightgreen)![badge](https://img.shields.io/badge/Vue.js-2.6.11-green)![badge](https://img.shields.io/badge/@vue/cli-4.4.6-green)![badge](https://img.shields.io/badge/yarn-1.22.4-blue)![badge](https://img.shields.io/badge/Django-2.1.15-orange)![badge](https://img.shields.io/badge/Python-3.7.6-orange)

### 2-2. Git Convention

---

#### 2-2-1. Git-Branch

Git-flowëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •í•´ì ¸ìˆìŠµë‹ˆë‹¤.

- master : ë°°í¬ ê°€ëŠ¥í•œ ìƒíƒœ ë¸Œëœì¹˜
- develop : ì—…ë°ì´íŠ¸ í•  ë¸Œëœì¹˜ + Docs ì—…ë°ì´íŠ¸ ë¸Œëœì¹˜
- feature : ê¸°ëŠ¥ì„ ê°œë°œí•˜ëŠ” ë¸Œëœì¹˜

#### 2-2-2. Git-commit

```bash
$ git commit -m "Jira ì´ìŠˆ ë²ˆí˜¸ | Header | ì„¤ëª…"
```

- JIRA ì´ìŠˆ ë²ˆí˜¸ or README
- Header
  - Initial : ê°€ì¥ ì²˜ìŒ ë§Œë“  ì½”ë“œ
  - Update : ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ë©´ì„œ ìˆ˜ì •/ì¶”ê°€/ë³´ì™„ëœ ì½”ë“œ
  - Fix : ë¹„ì •ìƒ ë™ì‘ ìˆ˜ì • ì½”ë“œ

### 2-3. ì™€ì´ì–´ í”„ë ˆì„ & ERD

-----------------------------------

<img src="./Docs/wireframe.JPG">

<img src="./We/ERD.png">



### 2-4. ì‚¬ìš© íŒ¨í‚¤ì§€, ë¼ì´ë¸ŒëŸ¬ë¦¬

---

> `Project/frontend`ì˜ `node_module`í´ë”ì™€ `Project/backend`ì˜ `requirements.txt` ì°¸ê³ .



## 3. ì‚¬ìš©í•œ ì½”ë“œ ë¦¬ë·°

### 3-1. ì´ë¯¸ì§€ ë¶„ì„ & ì €ì¥ì„ ìœ„í•œ ì½”ë“œ

> ì´ë¯¸ ë§Œë“¤ì–´ë‘” pbíŒŒì¼ì„ djangoì—ì„œ í¸í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í´ë”ë¥¼ ì˜®ê²¨ì„œ ì‚¬ìš©í•¨.

 ```python
def run_inference_on_image(imagePath, labelsFullPath): # ì´ í•¨ìˆ˜ë¥¼ í†µí•´ ë°›ì€ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ìƒìœ„ 5ê°œ ë™ë¬¼ì„ return
    answer = None

    if not tf.gfile.Exists(imagePath):
        tf.logging.fatal('File does not exist %s', imagePath)
        return answer

    image_data = tf.gfile.FastGFile(imagePath, 'rb').read()

    # ì €ì¥ëœ(saved) GraphDef íŒŒì¼ë¡œë¶€í„° graphë¥¼ ìƒì„±í•œë‹¤.

    with tf.Session() as sess:

        softmax_tensor = sess.graph.get_tensor_by_name('final_result:0')
        predictions = sess.run(softmax_tensor,
                               {'DecodeJpeg/contents:0': image_data})
        predictions = np.squeeze(predictions)

        top_k = predictions.argsort()[-5:][::-1]  # ê°€ì¥ ë†’ì€ í™•ë¥ ì„ ê°€ì§„ 5ê°œ(top 5)ì˜ ì˜ˆì¸¡ê°’(predictions)ì„ ì–»ëŠ”ë‹¤.
        f = open(labelsFullPath, 'rb')
        lines = f.readlines()
        labels = [str(w).replace("\n", "") for w in lines]
        result = []
        i = 1
        for node_id in top_k:
            human_string = labels[node_id]
            score = predictions[node_id]
            result.append({i:human_string[2:-3]}) # ë™ë¬¼ì˜ ì´ë¦„ë§Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´
            i += 1
        return result[:5] # ìƒìœ„ ë‹¤ì„¯ì¢…ë¥˜ì˜ ë™ë¬¼ì„ return

@api_view(['POST'])
def upload_image(request):
    img_string = request.data['img_base64'] # Post ìš”ì²­ìœ¼ë¡œ  base64ë¡œ ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ì˜´
    imgdata = base64.b64decode(img_string) # base64 ì •ë³´ë¥¼ ë””ì½”ë”©í•˜ì—¬ ì´ë¯¸ì§€ë¡œ ë³€ê²½
    filename = f'temp_image_{request.user}.jpg' # ì ì‹œ ì €ì¥í•  íŒŒì¼ëª…
    with open(filename, 'wb') as f:
        f.write(imgdata)
    config = ConfigProto(
            device_count = {'GPU': 0}
        )
    config.gpu_options.allow_growth = False
    session = InteractiveSession(config=config)
    modelFullPath = './tmp/output_graph.pb'
    with tf.gfile.FastGFile(modelFullPath, 'rb') as f:
        graph_def = tf.GraphDef()
        graph_def.ParseFromString(f.read())
        _ = tf.import_graph_def(graph_def, name='')
    result = run_inference_on_image(filename, './tmp/output_labels.txt')
    os.remove(filename) # ë¶„ì„ì´ ëë‚˜ê³  ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´ ë§Œë“¤ì–´ë‘” íŒŒì¼ ì‚­ì œ
    return Response({'result' : result})

@api_view(['POST'])
@permission_classes([IsAuthenticated]) # ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìš”ì²­ì„ ë°›ìŒ
def save_image(request):            # ì´ë¯¸ì§€ë¥¼ DBì— ì €ì¥í•˜ê¸° ìœ„í•´
    img_string = request.data['img_base64'] # ìœ„ì™€ ë™ì¼
    img_result = request.data['result']  # ìœ„ì—ì„œ ë¶„ì„í•œ ê²°ê³¼ë„ ê°€ì ¸ì˜´
    imgdata = base64.b64decode(img_string) # ìœ„ì™€ ë™ì¼
    now = datetime.now()	# íŒŒì¼ëª…ì„ ê²¹ì¹˜ì§€ ì•Šê²Œ í•˜ê¸°ìœ„í•´ ìš”ì²­ì‹œ í˜„ì¬ì‹œê°„ì„ ê°€ì ¸ì™€ì—¬ íŒŒì¼ëª…ì— ë„£ì–´ì„œ ì‚¬ìš©
    now = datetime.timestamp(now)
    filename = f'{img_result}_{request.user}_{now}.jpg'
    dir_list = os.listdir(settings.MEDIA_ROOT+'/users/')  
    # ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ í´ë”ë¥¼ ë§Œë“¤ì–´ ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ìœ ì €ì´ë¦„ì— ë§ëŠ” í´ë”ìƒì„±
 	# ì´ë¯¸ í´ë”ê°€ ë§Œë“¤ì–´ì§„ ê²½ìš°ì—ëŠ” ìƒˆë¡œ ë§Œë“¤ì§€ ì•ŠìŒ
    if str(request.user) not in dir_list:
        os.makedirs(settings.MEDIA_ROOT+'/users/'+f'{request.user}/')
    media_root = settings.MEDIA_ROOT+'/users/'+f'{request.user}/'+filename
    with open(media_root, 'wb') as f:
        f.write(imgdata)
    animal = get_object_or_404(Animal, english_name=img_result)
    # ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ë©° dbì— ì´ë¯¸ì§€ ì €ì¥ ê²½ë¡œë„ ì €ì¥
    animal_image = AnimalImage.objects.create(
        upload_image=f'users/{request.user}/{filename}',
        animal=animal,
        upload_user=request.user
    )
    # DB ë„ê°ì—ë„ ì €ì¥
    encyc = Encyclopedia.objects.create(
        user=request.user,
        image=animal_image
    )
    return Response({'message': 'ì €ì¥ ì™„ë£Œ'})
 ```